"use strict";(globalThis.webpackChunksimpo_home=globalThis.webpackChunksimpo_home||[]).push([[9518],{59518:(e,t,i)=>{i.r(t),i.d(t,{render:()=>h});var d=i(48443),n=i(90165),o=i(43457),r=i(83367);function a(e,t){e.forEach(e=>{const i={id:e.id,labelText:e.label,height:e.height,width:e.width,padding:e.padding??0};Object.keys(e).forEach(t=>{["id","label","height","width","padding","x","y"].includes(t)||(i[t]=e[t])}),t.add({group:"nodes",data:i,position:{x:e.x??0,y:e.y??0}})})}function s(e,t){e.forEach(e=>{const i={id:e.id,source:e.start,target:e.end};Object.keys(e).forEach(t=>{["id","start","end"].includes(t)||(i[t]=e[t])}),t.add({group:"edges",data:i})})}function c(e){return new Promise(t=>{const i=(0,r.Ltv)("body").append("div").attr("id","cy").attr("style","display:none"),o=(0,n.A)({container:document.getElementById("cy"),style:[{selector:"edge",style:{"curve-style":"bezier"}}]});i.remove(),a(e.nodes,o),s(e.edges,o),o.nodes().forEach(function(e){e.layoutDimensions=()=>{const t=e.data();return{w:t.width,h:t.height}}});o.layout({name:"cose-bilkent",quality:"proof",styleEnabled:!1,animate:!1}).run(),o.ready(e=>{d.Rm.info("Cytoscape ready",e),t(o)})})}function g(e){return e.nodes().map(e=>{const t=e.data(),i=e.position(),d={id:t.id,x:i.x,y:i.y};return Object.keys(t).forEach(e=>{"id"!==e&&(d[e]=t[e])}),d})}function u(e){return e.edges().map(e=>{const t=e.data(),i=e._private.rscratch,d={id:t.id,source:t.source,target:t.target,startX:i.startX,startY:i.startY,midX:i.midX,midY:i.midY,endX:i.endX,endY:i.endY};return Object.keys(t).forEach(e=>{["id","source","target"].includes(e)||(d[e]=t[e])}),d})}async function l(e,t){d.Rm.debug("Starting cose-bilkent layout algorithm");try{y(e);const t=await c(e),i=g(t),n=u(t);return d.Rm.debug(`Layout completed: ${i.length} nodes, ${n.length} edges`),{nodes:i,edges:n}}catch(i){throw d.Rm.error("Error in cose-bilkent layout algorithm:",i),i}}function y(e){if(!e)throw new Error("Layout data is required");if(!e.config)throw new Error("Configuration is required in layout data");if(!e.rootNode)throw new Error("Root node is required");if(!e.nodes||!Array.isArray(e.nodes))throw new Error("No nodes found in layout data");if(!Array.isArray(e.edges))throw new Error("Edges array is required in layout data");return!0}n.A.use(o),(0,d.K2)(a,"addNodes"),(0,d.K2)(s,"addEdges"),(0,d.K2)(c,"createCytoscapeInstance"),(0,d.K2)(g,"extractPositionedNodes"),(0,d.K2)(u,"extractPositionedEdges"),(0,d.K2)(l,"executeCoseBilkentLayout"),(0,d.K2)(y,"validateLayoutData");var h=(0,d.K2)(async(e,t,{insertCluster:i,insertEdge:d,insertEdgeLabel:n,insertMarkers:o,insertNode:r,log:a,positionEdgeLabel:s},{algorithm:c})=>{const g={},u={},y=t.select("g");o(y,e.markers,e.type,e.diagramId);const h=y.insert("g").attr("class","subgraphs"),m=y.insert("g").attr("class","edgePaths"),f=y.insert("g").attr("class","edgeLabels"),p=y.insert("g").attr("class","nodes");a.debug("Inserting nodes into DOM for dimension calculation"),await Promise.all(e.nodes.map(async t=>{if(t.isGroup){const e={...t};u[t.id]=e,g[t.id]=e,await i(h,t)}else{const i={...t};g[t.id]=i;const d=await r(p,t,{config:e.config,dir:e.direction||"TB"}),n=d.node().getBBox();i.width=n.width,i.height=n.height,i.domId=d,a.debug(`Node ${t.id} dimensions: ${n.width}x${n.height}`)}})),a.debug("Running cose-bilkent layout algorithm");const b={...e,nodes:e.nodes.map(e=>{const t=g[e.id];return{...e,width:t.width,height:t.height}})},w=await l(b,e.config);a.debug("Positioning nodes based on layout results"),w.nodes.forEach(e=>{const t=g[e.id];t?.domId&&(t.domId.attr("transform",`translate(${e.x}, ${e.y})`),t.x=e.x,t.y=e.y,a.debug(`Positioned node ${t.id} at center (${e.x}, ${e.y})`))}),w.edges.forEach(t=>{const i=e.edges.find(e=>e.id===t.id);i&&(i.points=[{x:t.startX,y:t.startY},{x:t.midX,y:t.midY},{x:t.endX,y:t.endY}])}),a.debug("Inserting and positioning edges"),await Promise.all(e.edges.map(async t=>{await n(f,t);const i=g[t.start??""],o=g[t.end??""];if(i&&o){const n=w.edges.find(e=>e.id===t.id);if(n){a.debug("APA01 positionedEdge",n);const r={...t},c=d(m,r,u,e.type,i,o,e.diagramId);s(r,c)}else{const n={...t,points:[{x:i.x||0,y:i.y||0},{x:o.x||0,y:o.y||0}]},r=d(m,n,u,e.type,i,o,e.diagramId);s(n,r)}}})),a.debug("Cose-bilkent rendering completed")},"render")}}]);